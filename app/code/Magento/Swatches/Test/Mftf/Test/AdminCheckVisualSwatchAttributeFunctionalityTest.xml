<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="AdminCheckVisualSwatchAttributeFunctionalityTest">
        <annotations>
            <features value="Swatches"/>
            <stories value="Product attributes"/>
            <title value="Visual Swatch Attribute"/>
            <description value="Create visual swatch attribute with empty, color and image options"/>
            <severity value="MAJOR"/>
            <testCaseId value="AC-3943"/>
        </annotations>
        <before>
            <!-- Login as admin -->
            <actionGroup ref="AdminLoginActionGroup" stepKey="loginAsAdmin"/>
        </before>
        <after>
            <actionGroup ref="AdminOpenProductAttributePageActionGroup" stepKey="goToProductAttributesToEditVisualSwatchAttribute"/>
            <actionGroup ref="ClearFiltersAdminDataGridActionGroup" stepKey="clearFilter"/>
            <!-- Delete product attribute and clear grid filter -->
            <deleteData createDataKey="createVisualSwatchAttribute" stepKey="deleteVisualSwatchAttribute"/>
            <!-- Admin logout -->
            <actionGroup ref="AdminLogoutActionGroup" stepKey="adminLogout"/>
        </after>

        <!-- Step1: Create Visual Swatch attribute -->
        <createData entity="VisualSwatchProductAttributeForm" stepKey="createVisualSwatchAttribute"/>
        <actionGroup ref="CliIndexerReindexActionGroup" stepKey="reindexPostCreatingVisualSwatchAttribute">
            <argument name="indices" value=""/>
        </actionGroup>
        <actionGroup ref="CliCacheFlushActionGroup" stepKey="flushCachePostCreatingVisualSwatchAttribute">
            <argument name="tags" value=""/>
        </actionGroup>
        <!-- Go to the edit page for the visual Swatch attribute -->
        <actionGroup ref="AdminOpenProductAttributePageActionGroup" stepKey="goToProductAttributesToEditVisualSwatchAttribute"/>
        <fillField selector="{{AdminProductAttributeGridSection.FilterByAttributeCode}}" userInput="$createVisualSwatchAttribute.attribute_code$" stepKey="fillFilterToEditVisualSwatchAttribute"/>
        <click selector="{{AdminProductAttributeGridSection.Search}}" stepKey="clickSearchToEditVisualSwatchAttribute"/>
        <click selector="{{AdminProductAttributeGridSection.AttributeCode('$createVisualSwatchAttribute.attribute_code$')}}" stepKey="clickVisualSwatchRowToEdit"/>
        <grabValueFrom selector="{{AdminManageSwatchSection.defaultLabelField}}" stepKey="grabAttributeValue"/>
        <click selector="{{AdminManageSwatchSection.addSwatch}}" stepKey="clickAddSwatchButtonForOption1"/>
        <fillField selector="{{AdminManageSwatchSection.adminInputByIndex('0')}}" userInput="Empty" stepKey="fillAdminTextForEmpty"/>
        <click selector="{{AdminManageSwatchSection.addSwatch}}" stepKey="clickAddSwatchButtonForOption2"/>
        <actionGroup ref="OpenSwatchMenuByIndexActionGroup" stepKey="clickSwatch">
            <argument name="index" value="1"/>
        </actionGroup>
        <click selector="{{AdminManageSwatchSection.nthChooseColor('2')}}" stepKey="clickChooseColor"/>
        <actionGroup ref="SetColorPickerByHexActionGroup" stepKey="fillColor">
            <argument name="nthColorPicker" value="1"/>
            <argument name="hexColor" value="e74c3c"/>
        </actionGroup>
        <fillField selector="{{AdminManageSwatchSection.adminInputByIndex('1')}}" userInput="Color" stepKey="fillAdminForColor"/>
        <waitForPageLoad stepKey="waitToAddColor"/>
        <!-- Save -->
        <click selector="{{AttributePropertiesSection.SaveAndEdit}}" stepKey="clickSaveAndEdit1"/>
        <waitForElementVisible selector="{{AdminProductMessagesSection.successMessage}}" stepKey="waitForSuccess"/>
        <actionGroup ref="AssertSwatchColorActionGroup" stepKey="assertSwatch1">
            <argument name="nthSwatch" value="2"/>
            <argument name="expectedStyle" value="background: rgb(231, 77, 60);"/>
        </actionGroup>
        <click selector="{{AdminManageSwatchSection.addSwatch}}" stepKey="clickAddSwatchButtonForOption3"/>
        <click selector="{{AttributePropertiesSection.defaultRadioButton('2')}}" stepKey="setAsDefault"/>
        <click selector="{{AdminManageSwatchSection.nthSwatchWindowEdit('3','1')}}" stepKey="clickSwatchButtonToEditForOption"/>
        <click selector="{{AdminManageSwatchSection.nthUploadFile('3')}}" stepKey="clickUploadFile1ForOption"/>
        <attachFile selector="input[name='datafile']" userInput="adobe-thumb.jpg" stepKey="attachFile1ForOption"/>
        <waitForElementNotVisible selector="{{AdminManageSwatchSection.swatchWindowUnavailable('0')}}" stepKey="waitForImageUploaded1"/>
        <fillField selector="{{AdminManageSwatchSection.adminInputByIndex('2')}}" userInput="File" stepKey="fillAdminImage"/>
        <waitForPageLoad stepKey="waitFileAttachedForOption"/>
        <selectOption selector="{{AttributePropertiesSection.Scope}}" userInput="1" stepKey="selectGlobalScope"/>
        <actionGroup ref="AdminProductAttributeSaveActionGroup" stepKey="saveAttributeSet"/>
    </test>
</tests>
